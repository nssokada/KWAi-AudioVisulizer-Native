package sample;/* autogenerated by Processing revision 1280 on 2022-04-19 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import ddf.minim.*;
import ddf.minim.analysis.*;
import ddf.minim.effects.*;
import ddf.minim.signals.*;
import ddf.minim.spi.*;
import ddf.minim.ugens.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class creativity extends PApplet {

//A.H
//importing all the necessary libraries here






Minim minim;
AudioPlayer audio;
AudioPlayer bg;
boolean fade = true;
boolean pause = false;
float rAngle = random(0.1f, 30);
float rStroke = random(0, 255);
float rStrokeSize = random(0.25f, 3);
float rWaveMap = random(2000, 10000);
int bands = 256; // must be multiple of two
float[] spectrum = new float[bands];
float[] sum = new float[bands];
float[] randomSpiral = {0.1f, 0.8f, 0.9f, 2.1f,2.4f,3.0f,3.6f,26.1f,33.1f};
int spiralChooser = 0;
int musicRandomizer = PApplet.parseInt(random(1, 4));
long current = System.currentTimeMillis();
FFT fft;
Particle[] particles;
PFont myFont;
boolean mo = true;
 public void setup() {
  colorMode(HSB, 360, 60, 60, 60);
  /* size commented out by preprocessor */;
  //fullScreen(P3D);
  /* smooth commented out by preprocessor */;
  frameRate(60);
  //AUDIO PROCESSING DONE HERE.
  minim = new Minim(this);
  if (musicRandomizer == 1) {
    audio = minim.loadFile("Limitless.mp3");
  } else if (musicRandomizer == 2) {
    audio = minim.loadFile("TakingFlight.mp3");
  } else {
    audio = minim.loadFile("Triumph.mp3");
  }
  audio.loop();
  fft = new FFT(audio.bufferSize(), audio.sampleRate() );
  fft.linAverages(bands);
  particles = new Particle[fft.specSize()];
  for (int i = 0; i < fft.specSize(); i++) {
    particles[i] = new Particle(i);
  }
  bg = minim.loadFile("AlphaWaves.mp3");
  bg.loop();
  bg.shiftGain(bg.getGain(), -10, 2500);
}

 public void draw() {
  fill(0);
  rect(0,0,600, height/20);
  fill(0xFFFFFFFF);
  myFont = createFont("Arial Bold", 60);
  textFont(myFont,35);
  textAlign(TOP);
  text("Press any key to change the spiral!", 0,40);
  pushStyle();
  colorMode(RGB, 360);   //REMOVE THIS OR NAH?
  if (fade) {
    noStroke();
    fill(0, 25);
    rect(0, 0, width, height);
  } else {
    background(0);
  }
  popStyle();
  fft.forward(audio.mix);
  for (int i = 0; i < fft.specSize() - 1; i++) {
    particles[i].update(fft.getBand(i), audio.mix.get(i*2));
    particles[i].render();
    particles[i].render();
  }
  float wave = sin(radians(frameCount));
  fft.forward(audio.mix);
  translate(width/2, height/2);
  float w =  wave*map(rWaveMap, 0, height, 500, 0);
  for (int i = 0; i < fft.specSize() - 1; i++) {
    //rotate(rAngle);
    //rotate(0.1); //0.8, 0.9, look good too.
    //make an array of good spirals
    //rotate(33.1);
    rotate(randomSpiral[spiralChooser]);
    stroke(0xFFF7FAF8); //WHITE
    line(850, i-w/2, -850, i++);
    strokeWeight(map(wave, -1, 1, 0.5f, rStrokeSize));
    stroke(0xFFFFD321); //YELLOW/ORANGE
    strokeWeight(map(wave, -1, 1, 0.5f, rStrokeSize));
    line(-850, -i+w, 550, i++);
    stroke(0xFF2BFC5A); //GREEN
    line(-850, i-w, 850, i++);
  }
}
 public void keyPressed(){
    spiralChooser = PApplet.parseInt(random(0, randomSpiral.length));
}
class Particle {
  PVector loc;
  PVector vel;

  float radius;
  float h;
  float s;
  float b;

  Particle(int id) {
    loc = new PVector(map(id, 0, fft.specSize(), 0, width), height/2);
    vel = new PVector(random(-1, 1), random(-1, 1));

    h = map(id, 0, fft.specSize(), 0, 360);
    s = 100;
    b = 100;
  }

   public void update(float _r, float _b) {
    loc.add(vel);

    if (loc.x < 0 || loc.x > width) {
      vel.x *= -1;
    }

    if (loc.y < 0 || loc.y > height) {
      vel.y *= -1;
    }

    radius = _r;
    radius = constrain(radius, 2, 100);

    b = map(_b, -1, 1, 0, 200);
  }

   public void render() {
    stroke(h, s, b, 50);
    fill(h, s, b, 50);
    ellipse(loc.x, loc.y, radius*2, radius*2);
  }
}


  public void settings() { size(1080, 1080);
smooth(8); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "creativity" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
